import { createAsyncThunk } from '@reduxjs/toolkit';

import * as api from '../../helpers/instance';
import { toast } from 'react-toastify';

export const register = createAsyncThunk(
  'auth/register',
  async (data, { rejectWithValue }) => {
    try {
      const result = await api.register(data);
      toast.info(
        'ğŸ¦„ We have sent you a message by email. Run over there and see',
        {
          position: 'top-center',
          autoClose: 5000,
          hideProgressBar: false,
          closeOnClick: true,
          pauseOnHover: true,
          draggable: true,
          progress: undefined,
          theme: 'light',
        }
      );
      return result;
    } catch ({ response }) {
      console.log(response);
      const { status, data } = response;
      const error = {
        status,
        message: data.message,
      };
      toast.warn(error.message, {
        position: toast.POSITION.BOTTOM_LEFT,
      });
      return rejectWithValue(error);
    }
  }
);

export const login = createAsyncThunk(
  'auth/login',
  async (data, { rejectWithValue }) => {
    try {
      const result = await api.login(data);
      return result;
    } catch ({ response }) {
      const { status, data } = response;
      const error = {
        status,
        message: data.message,
      };
      toast.warn(error.message, {
        position: toast.POSITION.BOTTOM_LEFT,
      });
      return rejectWithValue(error);
    }
  }
);

export const logout = createAsyncThunk(
  'auth/logout',
  async (_, { rejectWithValue }) => {
    try {
      const result = await api.logout();

      return result.data;
    } catch ({ response }) {
      console.log(response);
      const { status, data } = response;
      const error = {
        status,
        message: data.message,
      };
      return rejectWithValue(error);
    }
  }
);

export const current = createAsyncThunk(
  'auth/current',
  async (_, { rejectWithValue, getState }) => {
    try {
      const { auth } = getState();
      const result = await api.getCurrent(auth.token.accessToken);
      return result;
    } catch ({ response }) {
      const { status, data } = response;
      const error = {
        status,
        message: data.message,
      };
      return rejectWithValue(error);
    }
  }
);
